<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.daxalfred.demo.Dao.ExamPaperMapper">


    <select id="pageShow" resultType="exampaper">
        select * from ExamPaperInfo limit #{startIndex}, #{pageShow}
    </select>

    <select id="getExamPpaerTotal" resultType="int">
        select count(*) from ExamPaperInfo
    </select>

    <select id="getExamPaperById" resultType="exampaper">
        select * from ExamPaperInfo where examPaperId=#{examPaperId}
    </select>


    <delete id="isDelExamPaper">
       DELETE FROM ExamPaperInfo WHERE examPaperId=#{examPaperId}
    </delete>

    <update id="isUpdateExamPaper" parameterType="exampaper">
		UPDATE ExamPaperInfo SET
		examPaperName=#{examPaperName}, subjectNum=#{subjectNum},
		examPaperScore=#{examPaperScore}, division=#{division}, examPaperEasy=#{examPaperEasy}
		WHERE examPaperId=#{examPaperId}
	</update>

    <insert id="isAddExamPaper" parameterType="exampaper">
		INSERT INTO ExamPaperInfo VALUES(NULL, #{examPaperName}, #{subjectNum}, #{examPaperTime}, #{examPaperScore}, #{division}, #{examPaperEasy})
	</insert>


    <select id="getEsmByExamIdWithSubject"  resultType="Integer">
		SELECT esmId FROM ExamSubjectMiddleInfo WHERE examPaperId=#{examPaperId} AND subjectId=#{subjectId}
	</select>

    <!-- 修改试卷总分 -->
    <update id="isUpdateExamPaperScore" parameterType="java.util.Map">
		UPDATE ExamPaperInfo SET examPaperScore=examPaperScore+#{score}
		WHERE examPaperId=#{examPaperId}
	</update>


    <!-- 修改试卷试题总量 -->
    <update id="isUpdateExamPaperSubjects" parameterType="java.util.Map">
		UPDATE ExamPaperInfo SET subjectNum=subjectNum+#{subjectNum}
		WHERE examPaperId=#{examPaperId}
	</update>

    <insert id="isAddESM" parameterType="java.util.Map">
        INSERT INTO ExamSubjectMiddleInfo VALUES
        <if test="examPaperId != null">
            <if test="subjectIds != null">
                <foreach collection="subjectIds" item="subjectId" close=";" separator=",">
                    (NULL, #{examPaperId}, #{subjectId})
                </foreach>
            </if>
        </if>
    </insert>

   <select id="getExamPaperWithSubject" resultType="int">
        SELECT subjectid
        FROM ExamSubjectMiddleInfo where examPaperId=#{examPaperId}
    </select>


    <!-- 移除试卷中的试题 -->
    <delete id="removeSubjectWithExamPaper" parameterType="java.util.Map">
		DELETE FROM ExamSubjectMiddleInfo
		WHERE examPaperId=#{examPaperId} AND subjectId=#{subjectId}
	</delete>





</mapper>